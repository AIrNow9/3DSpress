<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Book a ride with <%= driverId %></title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; max-width: 720px; margin: 2rem auto; }
    input, textarea, button { width: 100%; padding: 0.5rem; font-size: 1rem; margin-bottom: 1rem; }
  </style>
</head>
<body>
  <h1>Book a ride with <%= driverId %></h1>
  <form id="booking">
    <input type="hidden" name="driverId" value="<%= driverId %>">
    <label>Your name<br>
      <input name="name" required>
    </label>
    <label>Phone (sms/call)<br>
      <input name="phone" required>
    </label>
    <label>Pickup address<br>
      <input name="pickup" required>
    </label>
    <label>Dropoff address<br>
      <input name="dropoff" required>
    </label>
    <label>When (date & time)<br>
      <input name="datetime" type="datetime-local" required>
    </label>
    <label>Special worker code (optional)<br>
      <input name="specialCode">
    </label>
    <label>Notes (optional)<br>
      <textarea name="notes"></textarea>
    </label>
    <button type="submit">Request Ride</button>
  </form>
  <div id="result"></div>
  <script>
    document.getElementById('booking').onsubmit = async (e) => {
      e.preventDefault();
      const fd = new FormData(e.target);
      const payload = {};
      for (const [k, v] of fd.entries()) payload[k] = v;
      const res = await fetch('/api/book', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if (data.ok) {
        document.getElementById('result').innerHTML =
          '<p>Booked! Confirmation: <a href="' + data.confirmUrl + '">' + data.confirmUrl + '</a></p>';
        e.target.reset();
      } else {
        document.getElementById('result').textContent = 'Error: ' + (data.error || 'unknown');
      }
    }
  </script>
</body>
</html>